<h1>Kigurumi</h1>

<%= form_with url:'' do |f| %>
  <label>名前</label>
  <%= f.text_field :person_name, id: :person_name %><br>
  <label>Twitter</label>
  @<%= f.text_field :twitter, id: :twitter %><br>

  <label>キャラクター名</label>
  <%= f.text_field :character_name, id: :character_name %><br>
  <label>作品名</label>
  <%= f.text_field :work_name, id: :work_name %><br>
  <label>工房</label>
  <%= f.select :factory_id, Factory.all.map{|e| [e.name, e.id]} %><br>
  <label>素体</label>
  <%= f.select :base_id, [] %><br>
  <label>以前の所有者</label>
  <%= f.text_field :person_name %>
<% end %>

<script>
$(function(){
  $('#person_name').autocomplete({
    source: '/person/auto_complete.json',
    delay: 100,
    minLength: 1,
    focus: function(event, ui){
      $('#person_name').val(ui.item.name);
      console.log($('#twitter').val());
      if($('#twitter').val() === '') $('#twitter').val(ui.item.twitter);
      return false;
    },
    select: function(event, ui){
      $('#person_name').val(ui.item.name);
      if($('#twitter').val() === '') $('#twitter').val(ui.item.twitter);
      return false;
    }
  }).data("ui-autocomplete")._renderItem = function(ul, item) {
      return $("<li>").attr("data-value", item.name).data("ui-autocomplete-item", item).append("<a>" + item.name + "</a>").appendTo(ul);
  };

  $('#twitter').autocomplete({
    source: '/person/auto_complete_twitter.json',
    delay: 100,
    minLength: 1,
    focus: function(event, ui){
      $('#twitter').val(ui.item.twitter);
      if($('#person_name').val() === '') $('#person_name').val(ui.item.name);
      return false;
    },
    select: function(event, ui){
      $('#twitter').val(ui.item.twitter);
      if($('#person_name').val() === '') $('#person_name').val(ui.item.name);
      return false;
    }
  }).data("ui-autocomplete")._renderItem = function(ul, item) {
      return $("<li>").attr("data-value", item.name).data("ui-autocomplete-item", item).append("<a>" + item.twitter + "</a>").appendTo(ul);
  };

  $('#character_name').autocomplete({
    source: '/character/auto_complete.json',
    delay: 100,
    minLength: 1,
    focus: function(event, ui){
      $('#character_name').val(ui.item.name);
      if($('#work_name').val() === '') $('#work_name').val(ui.item.work.name);
      return false;
    },
    select: function(event, ui){
      $('#character_name').val(ui.item.name);
      if($('#work_name').val() === '') $('#work_name').val(ui.item.work.name);
      return false;
    }
  }).data("ui-autocomplete")._renderItem = function(ul, item) {
      return $("<li>").attr("data-value", item.name).data("ui-autocomplete-item", item).append("<a>" + item.name + "</a>").appendTo(ul);
  };

  $('#work_name').autocomplete({
    source: '/work/auto_complete.json',
    delay: 100,
    minLength: 1,
    focus: function(event, ui){
      $('#work_name').val(ui.item.name);
      return false;
    },
    select: function(event, ui){
      $('#work_name').val(ui.item.name);
      return false;
    }
  }).data("ui-autocomplete")._renderItem = function(ul, item) {
      return $("<li>").attr("data-value", item.name).data("ui-autocomplete-item", item).append("<a>" + item.name + "</a>").appendTo(ul);
  };
});
</script>